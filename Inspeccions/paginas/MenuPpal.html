<!DOCTYPE html>
<html>
<head>
    <title>Menu principal</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width; initial-scale=1" />

    <!-- !CSS -->
    <link href="../css/jquery.mobile-1.3.1.min.css" rel="stylesheet" type="text/css" />
    <link href="../css/jquery.mobile.datebox-1.0.1.min.css" rel="stylesheet" type="text/css" />
    <link href="../css/index.css" rel="stylesheet" type="text/css" />
    <link href="../css/themes/AjParets/Tema_AjParets.min.css" rel="stylesheet" />

    <script src="../js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="../js/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>
    <script src="../js/jquery.ba-dotimeout.min.js" type="text/javascript"></script>
    <script src="../js/underscore-min.js" type="text/javascript"></script>

    <!-- Negocio  -->
    <script src="../negocio/index.js" type="text/javascript"></script>
    <script src="../negocio/negoci.js" type="text/javascript"></script>
    <script src="../negocio/tablas.js" type="text/javascript"></script>
    <script src="../negocio/utilitats.js" type="text/javascript"></script>
    <script src="../negocio/webService.js" type="text/javascript"></script>
    <script src="../negocio/pageNuevaIncidencia.js" type="text/javascript"></script>
    <script src="../negocio/pageConsultaIncidencia.js" type="text/javascript"></script>
    <script src="../negocio/pageSelRecorregut.js" type="text/javascript"></script>
    <script src="../negocio/baseDades.js" type="text/javascript"></script>

    <!-- objetos -->
   <script src="../objetos/atributo.js" type="text/javascript"></script>

    <!-- Mapa -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>

</head>

<body>
<!-- Pantalla de Menu Ppal (Accedir nomes si logat ok)     -->
<div data-role="page" id="MenuPpal">
    <div data-role="header" data-theme="c">
        <h3>
            <div class="ui-grid-a" data-mini="false">
                <div class="ui-block-a" data-mini="false">Menu Principal</div>
                <div class="ui-block-b" data-position="right" data-mini="false">
                    <label id="labelRecInformado" style='width:15%; text-align:right; font-size:x-small; vertical-align:middle; color:Black;'></label>
                </div>
            </div>
        </h3>

        <a href="#Home" data-icon="home" data-iconpos="notext" data-direction="reverse" data-theme="b"></a>
    </div>
    <div data-role="content">
        <br/>
        <table style="width:100%;">
            <tr>
                <td colspan="2">
                    <a href="" onclick="abrirPagina('pageNuevaIncidencia',true);" data-role="button" data-inline="false" data-theme="b">Nova Incidència / Sanció</a>
                </td>
            </tr>
            <tr>
                <td>
                     <a href="" style="word-wrap: normal" onclick="abrirPagina('pageConsultaIncidencias',true);" data-role="button" data-inline="false" data-theme="b">Modificar Incidències</a>
                </td>
                <td>
                    <a href="" onclick="abrirPagina('pageConsultaSancions',true);" data-role="button" data-inline="false" data-theme="b">Modificar Sancions</a>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <a href="" onclick="abrirPagina('pageSelRecorregut',true);" data-role="button" data-inline="false" data-theme="b">Seleccionar Recorregut</a>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <a href="#popupConfiguracio" data-rel="popup" data-position-to="window" data-role="button" data-inline="false" data-theme="b" data-transition="pop"><label>Configuració</label></a>
                </td>
            </tr>
            <tr>
                <td>
                    <a href="#popupSincro" data-rel="popup" data-position-to="window" data-role="button" data-inline="false" data-theme="b" data-transition="pop"><label>Sincronització</label></a>
                </td>
                <td>
                    <a href="" onclick="abrirPagina('pageMestres',true);" data-role="button" data-inline="false" data-theme="b" >Actualitzar Mestres</a>
                </td>
            </tr>
        </table>
        </br>

    </div>

    <div data-role="footer" data-theme="f" data-position="fixed" style="text-align: center;">
        <table style="width:100%;"><tr><td style="background-color:LightGrey; width:100%;"><label   style="color:Gray; font-size:small; font-weight:normal; background-color:LightGrey;">&#169;2014 SETTING Consultoria en T.I., S.L.</label></td></tr></table>
    </div>

    <div data-role="popup" id="popupMppal" data-theme="b" data-mini="false">
        <div data-role="popup" id="popupSincro" data-theme="b" class="ui-corner-all">
            <form  id="formSincro" data-theme="b">
                <div style="padding:5px;text-align: center;" data-mini="false">
                    <table>
                        <tr>
                            <td colspan="2">
                                <label>Segur que vol sincronitzar les dades??</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <a href='MenuPpal.html' rel="external" type="button" id="buttonTornar" data-inline="true" data-theme="b" data-mini="false" data-icon="arrow-l" data-position="center" >Tornar</a>
                            </td>
                            <td>
                                <a href='' onclick="sincronizar();" rel="external" type="button" id="buttonAccedir" data-inline="true" data-theme="b" data-mini="false" data-icon="arrow-r" data-position="center" >Sincronitzar</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </div>
    </div>

    <div data-role="popup" id="popupMppal2" data-theme="b" data-mini="false">
        <div data-role="popup" id="popupConfiguracio" data-theme="b" class="ui-corner-all">
            <form  id="formConfiguracio" data-theme="b">
                <div style="padding:5px;text-align: center;" data-mini="false">

                            <table>
                                <tr>
                                    <td rowspan="2">
                                        <img src="../images/candado70px.gif" width="90%"  alt="Logo">
                                    </td>
                                    <td>
                                        <label style="color: darkred; font-style: bold">Àrea Restringida!</label>
                                    </td>
                                </tr>
                                <tr>

                                    <td>
                                        <label>Introdueixi la clau correcta per accedir-hi.</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="txtPassword" data-mini="false">Clau accés:</label>
                                    </td>
                                    <td>
                                        <input name="txtPassword" id="txtPassword" placeholder="Clau accés" value="Clau accés" type="password" required="required" data-inline="true" data-mini="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <a href='MenuPpal.html' rel="external" type="button" id="buttonTornar1" data-inline="true" data-theme="b" data-mini="false" data-icon="arrow-l" data-position="center" >Tornar</a>
                                    </td>
                                    <td style="text-align: right">
                                        <a href='' onclick="entrarConfig();" rel="external" type="button" id="buttonAccedirConfig" data-inline="true" data-theme="b" data-mini="false" data-icon="arrow-r" data-position="center" >Accedir</a>
                                    </td>
                                </tr>
                            </table>
                </div>
            </form>
        </div>
    </div>

</div>

<script type="text/javascript">
    $(document).bind('pageinit', function(event){

        var lvAtributs = $('#listviewAtributs');
        var liMesInfoAtributs =  $('#liMesInfoAtributs');

        function muestraDireccion(){
            var sSelComboCarrer =  indefinidoOnullToVacio($('#selectCARRER').find(":selected").text());
            if(sSelComboCarrer != '' && sSelComboCarrer != 'Seleccioni el carrer')
            {
                var sTipoVia = sSelComboCarrer.split("(")[1].substr(0, (sSelComboCarrer.split("(")[1].length -1));
                var sCalle = sSelComboCarrer.split("(")[0];
                $('#labelLoaclizacionInformada').text( sTipoVia + ' ' + sCalle + ', ' + $('#inputNUM').val() );
                return sTipoVia + ' ' + sCalle + ', ' + $('#inputNUM').val();
            }
            else
                return '';
        }

        function limpiarAtributs(){
            try{
            lvAtributs.empty();
            lvAtributs.children().remove('li');
            lvAtributs.listview('refresh');
            }
            catch(e) {}
        }

        function visibilidadInfoAtributs(bVer){
            if(bVer)
                liMesInfoAtributs.text('carregant atributs ...').css("color", "yellow");
           else
                liMesInfoAtributs.text('mes informació de la incidència').css("color", "white");
        }

        visibilidadInfoAtributs(false);

//ini EVENTOS DE LA PAGINA NuevaIncidencia *************************************************************************************
        //cargar los elementos de nivel 2 según nivel 1 seleccionado
        $("#selectAMBIT").bind( "change", function(event, ui) {
            limpiarAtributs();
            $('#labelTipoIncInformado').text($('#selectAMBIT option:selected').text());
            cargaComboDesdeArray($('#selectELEMENT'), "seleccioni subtipus", cargaTablaEnArray("incNivel2", "item_" + $("#selectAMBIT").val()));
        }) ;

        //cargar los items de nivel 3 según nivel 2 seleccionado
        $("#selectELEMENT").bind( "change", function(event, ui) {
            limpiarAtributs();
            $('#labelTipoIncInformado').text( $('#selectAMBIT option:selected').text() + '/' + $('#selectELEMENT option:selected').text());
            cargaComboDesdeArray($('#selectITEM'), "seleccioni subtipus", cargaTablaEnArray("incNivel3", "item_" + $("#selectELEMENT").val()));
        });

        cargaComboDesdeArray($('#selectRec'), "Recorreguts ", cargaTablaEnArray("recorreguts", "recorregut"));
        $("#selectRec").bind( "change", function(event, ui) {
            $('#labelRecorregut').text($('#selectRec option:selected').text());
            $('#labelRecInformado').text($('#selectRec option:selected').text());
        });


        //cargar los atributos según nivel 3 seleccionado
        $("#selectITEM").bind( "change", function(event, ui) {
            //cargar el listviewAtributs con los atributos de este item
            visibilidadInfoAtributs(true);
            $('#labelTipoIncInformado').text($('#selectAMBIT option:selected').text() + '/' + $('#selectELEMENT option:selected').text() + '/' + $('#selectITEM option:selected').text());
            $.doTimeout(100, function(){
                limpiarAtributs();
                $.doTimeout(100, function(){
                    cargaAtributos($('#selectITEM').val() ,lvAtributs );
                    visibilidadInfoAtributs(false);
                });
            });
        });

        $("#textareaObservaciones").bind( "change", function(event, ui) {
            var s =  $("#textareaObservaciones").val();
            if(s.length > 25) s = s.substr(0,25) + "...";
            $('#labelObservacionesInformadas').text(s);
        });

        $("#selectLletraIniCARRER").bind( "change", function(event, ui) {
            cargaCarrersEnArray(); //rellena el array de calles que empiezan por esa letra desde el fic XML
            cargaCalles();  //rellena el combo desde el array de Carrers
        });

        $("#selectCARRER").bind( "change", function(event, ui) {
            var sDirec = muestraDireccion();
            if( sDirec == '') return;
            crearMarcadorDesdeCalleNum();
        });

        $("#inputNUM").bind( "change", function(event, ui) {
            muestraDireccion();
            if( muestraDireccion() == '') return;
            crearMarcadorDesdeCalleNum();
        });

        $('#collapsibleLocalizacion').bind('collapse', function () {
            if( muestraDireccion() == '') return;
        });

        $('#divLocalizacion').bind('expand', function () {
            $('#divMensajeMapa').hide();  //de inicio que no ponga que no se ha podido cargar el mapa
        });

//fin EVENTOS DE LA PAGINA NuevaIncidencia *************************************************************************************



    });
</script>

</body>

</html>